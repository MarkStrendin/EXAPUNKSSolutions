VOID M
VOID M

;DISPATCH A BOT TO READ
;ENCRYPTION KEY
REPL ENCRYPTOBOT
REPL DATABOT

;PREPARE TO ENCRYPT
GRAB 301
LINK 800
SEEK 1
MARK RXLOOP
TEST EOF
TJMP DONEENCRYPT
;TEST IF THE PRODUCT
;WOULD BE OVER 10K

;THE DATA AND KEY ARE
;UNSIGNED BUT THE 
;REGISTER IS SIGNED
;SO WE CAN SUBTRACT 
;5000 AND ADD IT BACK
;WHEN WE SEND TO DATA
COPY F X

;ADJUST
SUBI X 9999 X

;LOCAL MODE
MODE

;RX KEY
ADDI X M X

;XMIT THE VALUE

;GLOBAL MODE
MODE
SWIZ X 4321 M
JUMP RXLOOP
MARK DONEENCRYPT
WIPE
KILL
LINK 799
KILL
HALT

MARK DATABOT
LINK 800
LINK 799
MARK DATALOOP
COPY M X
;COPY X #DATA
TEST X > 1
FJMP NOADJUST
SUBI X 9999 X
SUBI X 1 X
MARK NOADJUST
ADDI X 9999 #DATA
JUMP DATALOOP

MARK ENCRYPTOBOT
;ONLY XMIT KEY LOCALLY
MODE
;GRAB THE ENCRYPTION KEY
LINK 800
GRAB 199
;TX KEY
MARK TXLOOP
COPY F M
TEST EOF
FJMP TXLOOP
SEEK -9999
JUMP TXLOOP